{% extends 'Review/base.html' %}
{% load static %}

{% block title %} {{build.building_name}} {% endblock %}

{% block content %}

    <style>
        .comment-container {
            width: 100%;
            padding: 12px;
        }

        .comment-profile-img{
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }
        
        #map {
            width: 80%;
            height: 400px;
            background-color: grey;
        }

        .accordion {
            background-colour: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
            margin-bottom: 10px;
        }

        .active, .accordion:hover {
            background-color: #ccc;
        }

        .panel{
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
        }


        .accordion:after {
            content: '\02795'; /* Unicode character for "plus" sign (+) */
            font-size: 13px;
            color: #777;
            float: right;
            margin-left: 5px;
        }
          
        .active:after {
            content: "\2796"; /* Unicode character for "minus" sign (-) */
        }

        .spacing {
            margin-bottom: 50px;
        }

    </style>


    <div class="template-page-container">

        <h2>{{ building.building_name }}</h2>
            <div style="width: 100%;">

                <div style="display: flex">
                    <img  class="building-picture" src="{{ MEDIA_URL }}{{ building.building_image }}"  alt="{{ building.building_name }}" style="max-width: 100%; height: auto; margin: 0 auto; text-align: center">
                </div>

                <div style="padding: 12px; ">
                    <p>Description: {{ building.building_description }}</p>

                    <div style="display: flex; justify-content: space-between">
                        <!---<p class = "btn btn-light mr-2 mt-3"><a href="{{ building.google_map }}" target="_blank">Google Map</a></p> -->
                        <p class = "btn btn-light mr-2 mt-3"><a href="{{ building.building_instagram }}" target="_blank">Instagram</a></p>
                        <p class = "btn btn-light mr-2 mt-3"><a href="{{ building.building_website }}" target="_blank">Website</a></p>
                    </div>

                </div>
            </div>

            
            <div class = "spacing">
                {% if rooms %}
                    <h2>Rooms:</h2>
                        {% for room in rooms %}

                            <button class = "accordion">{{ room.room_title }}</button>

                            <div class = "panel">
                                <img src = "{{ MEDIA_URL }}{{ room.room_picture }}">
                            </div>

                        {% endfor %}

                {% else %}
                    <p><strong>This building has no rooms or none have been added yet.</strong></p>
                {% endif %}

                <script>
                    var acc = document.getElementsByClassName("accordion");
                    var i;
                    for (i = 0; i < acc.length; i++) {
                        acc[i].addEventListener("click", function() {
                            this.classList.toggle("active");
                            var panel = this.nextElementSibling;
                            if(panel.style.maxHeight){
                                panel.style.maxHeight = null;
                            } else{
                                panel.style.maxHeight = panel.scrollHeight + "px";
                            }
                    });
                }
                </script>
            </div>



    
            <div id = "map">

                <script>
                    function initMap() {
                        let location = {lat: {{ latitude }}, lng: {{ longtitude }}};
                        let map = new google.maps.Map(
                            document.getElementById('map'), {zoom: 17, center: location}
                            );

                        let marker = new google.maps.Marker({position: location, map: map})
                    }
                </script>

                {% if building.google_map %}

                <script async defer src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyClzpypLber90-EPZWdCFd2_Z9AjhhGSdU&callback=initMap"></script>


                {% endif %}

        </div>


        <div class="divider"></div>

            {% for comment in building.comments.all %}

                <div class="comment-container">
                    <!-- Assuming the User model has a one-to-one relationship with Profile named 'profile' -->
                    <div>
                        <img src="{{ comment.author.profile.picture.url }}" alt="{{ comment.author.username }}'s profile picture" class="comment-profile-img">
                        <span style="margin-left: 18px">{{ comment.author.username }}</span>
                    </div>
                    <p style="margin-top: 18px">{{ comment.text }}</p>
                </div>

            {% endfor %}


            {%  if building.comments.all %}
                <div class="divider"></div>
            {% endif %}

            {% if user.is_authenticated %}
                <a href="{% url 'new_level' %}" class="building-submit add-new-btn">Add a new Level</a>
            {% endif %}
    

    </div>


{% endblock %}
